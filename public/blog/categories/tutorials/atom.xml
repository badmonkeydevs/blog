<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Tutorials | Bad Monkey Press]]></title>
  <link href="http://blog.badmonkeys.io/blog/categories/tutorials/atom.xml" rel="self"/>
  <link href="http://blog.badmonkeys.io/"/>
  <updated>2016-01-11T01:08:58-05:00</updated>
  <id>http://blog.badmonkeys.io/</id>
  <author>
    <name><![CDATA[Michael Kelly]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[How to Build Your Own Rails Gem: Part 1 - the Gem]]></title>
    <link href="http://blog.badmonkeys.io/blog/2015/06/09/how-to-build-your-own-rails-gem-part-1/"/>
    <updated>2015-06-09T00:00:00-04:00</updated>
    <id>http://blog.badmonkeys.io/blog/2015/06/09/how-to-build-your-own-rails-gem-part-1</id>
    <content type="html"><![CDATA[<p>A walkthrough of  the process of creating a basic gem structure and gem
development workflow.</p>

<!-- more -->


<h2>Creating a Basic Gem and Setting Up Github</h2>

<p>This week we&rsquo;re going to get our project setup and create our basic
skeleton which will act as the foundation of sidekiq-workflow. This is
probably going to be a long post, but you are welcome to skip any
sections with which you&rsquo;re familiar.</p>

<h2>Let&rsquo;s Get Started</h2>

<ul>
<li><a href="#skeleton">The Generator and Gem Skeleton</a></li>
<li><a href="#gemspec">The Gemspec</a></li>
<li><a href="#module">The Workflow Module</a></li>
<li><a href="#source-control">Getting the Gem Into Source Control</a></li>
<li><a href="#rubygems">Deploying the Gem to RubyGems</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>


<p><a name="skeleton"></a></p>

<h3>The Generator and Gem Skeleton</h3>

<p>Bundler is the gold standard for gem packaging and management. If you&rsquo;ve
done any rails development (and I sincerely hope you have, it&rsquo;s great
fun!) you&rsquo;re familiar with the project&rsquo;s <code>Gemfile</code> which is used by
bundler when it installs dependencies. Luckily for us, it also includes
a generator for a skeleton gem. The generator has some special magic
sauce based on your gem&rsquo;s name. You can find a full reference on <a href="http://guides.rubygems.org/name-your-gem/">How to
Name Your Gem</a> over in the
RubyGems guides. In our case, I&rsquo;m using <code>sidekiq-workflow</code> because the
<code>-</code> between <code>sidekiq</code> and <code>workflow</code> indicates that <code>sidekiq</code> is the
name of my top level module and <code>workflow</code> is a sub-module. With this I
can write syntax like:</p>

<pre><code class="ruby"># run a workflow with parameters
Sidekiq::Workflow.run(workflow_definition, *args)

# or include sub-classes like this later
Sidekiq::Workflow::Monitor.new()
</code></pre>

<p>This keeps our gem in the same namespace as Sidekiq itself and makes for
a rather clean gem API. The generator command looks like this:
<code>bash
bundle gem sidekiq-workflow
</code></p>

<p>Bundler will create a folder in the current directory named
<code>sidekiq-workflow</code> and then generate all the necessary gem files within
it. You should see output similar to:</p>

<pre><code class="bash">Code of conduct enabled in config
MIT License enabled in config
create sidekiq-workflow/Gemfile
create sidekiq-workflow/.gitignore
create sidekiq-workflow/lib/sidekiq/workflow.rb
create sidekiq-workflow/lib/sidekiq/workflow/version.rb
create sidekiq-workflow/sidekiq-workflow.gemspec
create sidekiq-workflow/Rakefile
create sidekiq-workflow/README.md
create sidekiq-workflow/bin/console
create sidekiq-workflow/bin/setup
create sidekiq-workflow/CODE_OF_CONDUCT.md
create sidekiq-workflow/LICENSE.txt
create sidekiq-workflow/.travis.yml
create sidekiq-workflow/.rspec
create sidekiq-workflow/spec/spec_helper.rb
create sidekiq-workflow/spec/sidekiq/workflow_spec.rb
Initializing git repo in /home/michael/Data/gems/sidekiq-workflow
</code></pre>

<p>You can see from the output that this command has generated a lot of
files for your gem. Most of these are standard like <code>.gitignore</code>,
<code>README.md</code>, <code>LICENSE.txt</code>, familiar rspec testing setup, etc. However,
when it comes to the actual gem files, there are two that are the most
important. They are <code>sidekiq-workflow.gemspec</code> and
<code>lib/sidekiq/workflow.rb</code>. I&rsquo;ll discuss both in detail below.</p>

<p><a name="gemspec"></a></p>

<h4>The Gemspec</h4>

<p>The <code>gemspec</code> file is the main location for the configuration of our
gem&rsquo;s metadata. This is where we set fancy things like our gem name,
version, summary/description, gem dependecies, etc. The <code>gemspec</code> file
for sidekiq-workflow looks like this:</p>

<pre><code class="ruby"># coding: utf-8
lib = File.expand_path('../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)
require 'sidekiq/workflow/version'

Gem::Specification.new do |spec|
  spec.name          = 'sidekiq-workflow'
  spec.version       = Sidekiq::Workflow::VERSION
  spec.authors       = ['Michael Kelly']
  spec.email         = ['michaelkelly322@gmail.com']

  spec.summary       = 'Complex workflow management in
Sidekiq'
  spec.description   = 'Allows the execution of mixed parallel and
sequential workflows.  A workflow can be defined at runtime and executed
with full sidekiq integration.'
  spec.homepage      =
'https://github.com/michaelkelly322/sidekiq-workflow'
  spec.license       = 'MIT'

  spec.files         = `git ls-files -z`.split('\x0').reject {
|f| f.match(%r{^(test|spec|features)/}) }
  spec.bindir        = 'exe'
  spec.executables   = spec.files.grep(%r{^exe/}) { |f| File.basename(f)
}
  spec.require_paths = ['lib']

  spec.required_ruby_version = '1.9'
  spec.add_development_dependency 'bundler', '~&lt;
1.10'
  spec.add_development_dependency 'rake', '~&lt;
10.0'
  spec.add_development_dependency 'rspec', '~&lt;
3.2'
end
</code></pre>

<p>There&rsquo;s a lot of boiler plate there that we don&rsquo;t really have the screen
space to explore in this tutorial (I plan on posting a dedicated post on
the elements of a <code>gemspec</code> file in the near future). The default
configuration is pretty good for now (except of course the things that
are custom to our gem like name and description). What is important to
note is that it is extremely bad form to use the <code>Gemfile</code> in our gem to
manage dependecies. Instead, we use the <code>gemspec</code> file instead. Notice
the section that starts with the line <code>spec.add_development_dependency
"bundler", "~&gt; 1.10"</code>? This adds a development dependency on bundler.
Development dependencies are gems that are used during the development
of our gem, but not to be included in the actual packaged gem (things
like testing, building, etc.). To add runtime dependencies you would use
<code>spec.add_runtime_dependency 'gem_name', '1.2.3'</code> which tells the spec
that the gem is to be included as a dependency when the gem is packaged
for release (meaning our users will need to have these gems to run
ours).</p>

<p>This structure is similar to groups in a standard <code>Gemfile</code>. However,
the <code>Gemfile</code> itself will be used by our users when installing
dependencies and their configuration has to be passed through the gem
packaging process to be setup properly. That is why we include them in
the <code>gemspec</code> and not directly in the <code>Gemfile</code>.
<a name="module"></a></p>

<h4>The Workflow Module</h4>

<p>The other major file involved with gem development is the gem&rsquo;s main
module file. It can be found in the <code>lib/</code> parent folder that bundler
created. In our case, it is located at <code>lib/sidekiq/workflow.rb</code> and if
you haven&rsquo;t modified it yet should look like:</p>

<pre><code class="ruby">require 'sidekiq/workflow/version'

module Sidekiq
  module Workflow
    # Your code goes here...
  end
end
</code></pre>

<p>This is essentially the entry point of your gem. Remember earlier when I
talked about syntax like <code>Sidekiq::Workflow.run()</code>? Well here&rsquo;s where
we&rsquo;d implement a run method, but more on that in a later post ;)</p>

<p><a name="source-control"></a></p>

<h3>Getting the Gem Into Source Control</h3>

<p>Before we commit any of our code above, we need to make one modification
to our <code>.gitignore</code> file
<code>
*.gem
</code>
This way we don&rsquo;t commit our actual bundled gem after we&rsquo;ve built it for
deployment to RubyGems. A flaw in the generator in my opinion because
the standard practice is to bundle the gem from within your projects
directory. Therefore, we shouldn&rsquo;t be committing specific (read
versioned) <code>.gem</code> files. The default should be to exclude them.</p>

<p>I also like to start my gem development with an obviously not
production-ready version. Bundler&rsquo;s generator initialized a file called
<code>lib/sidekiq/workflow/version.rb</code>. If you noticed above, our <code>gemspec</code>
file references this files module when setting the gem version (makes it
easier to script bumping the version number. The default version is
<code>0.1.0</code>. But based on my experience with semantic versioning, it is best
to label all MVP work as a hotfix/patch version <em>without</em> any major or
minor version. This shows that the product is moving forward and is
easily tracked throughout development, but is obvious to a user that the
gem is only wee babe.</p>

<pre><code class="ruby">module Sidekiq
  module Workflow
    VERSION = '0.0.1';
  end
end
</code></pre>

<p>Based on this, sidekiq-workflow has an initial version of <code>0.0.1</code>. We&rsquo;ll
talk more about this below when we discuss deploying our gem to
<a href="https://rubygems.org/">RubyGems</a>.</p>

<p>There are many other things we could customize as part of this initial
setup. For instance, there is some <code>TODO</code> text in the <code>README.md</code> file
by default (this file is shown on the Github repository&rsquo;s front page)
that we could replace with actual readme information. But for now we
should be ready to commit our work and get it into source control.
Commit your changes with something like:</p>

<pre><code class="bash">git commit -am 'Creates initial gem skeleton'
</code></pre>

<p>Now all that&rsquo;s left is to add our remote Github repository to our local
git remotes as <code>origin</code> and push our code so that it is safely in the
cloud.</p>

<pre><code class="bash">git remote add origin
git@github.com:michaelkelly322/sidekiq-workflow.git
git push origin master
</code></pre>

<p>We now have an open source gem ready to start development up on Github.
Take a look at the actual <a href="https://github.com/michaelkelly322/sidekiq-workflow">sidekiq-workflow repository</a>! Now
let&rsquo;s work on making it available to developers around the world.</p>

<p><a name="rubygems"></a></p>

<h3>Deploying the Gem to RubyGems</h3>

<p>Luckily, the nice folks over at <a href="http://rubygems.org">RubyGems</a> have
made the process of making a gem publically available to anyone with a
<code>Gemfile</code> and half a mind to type <code>gem 'sidekiq-workflow'</code> <em>EXTREMELY</em>
easy. It is a two step process that includes building the gem and
deploying the gem to RubyGems' servers.</p>

<p>Building the gem is a simple as running the following command:</p>

<pre><code class="bash">gem build sidekiq-workflow.gemspec
</code></pre>

<p>This will build our modules into our gem based on the gemspec and saved
it to a <code>.gem</code> file. The output should be something like if everything
went according to plan:</p>

<pre><code class="bash">  Successfully built RubyGem
  Name: sidekiq-workflow
  Version: 0.0.1
  File: sidekiq-workflow-0.0.1.gem
</code></pre>

<p>The final step is to deploy our gem. This step is a bit hairy so bare
with me. We have to first setup an account over at
<a href="http://rubygems.org">RubyGems</a> and download our credentials file. Once
you&rsquo;ve got an account created, use the following in a terminal to setup
your credentials:</p>

<pre><code class="bash">curl -u thebadmonkeydev https://rubygems.org/api/v1/api_key.yaml
&lt; ~/.gem/credentials; chmod 0600 ~/.gem/credentials
</code></pre>

<p>you&rsquo;ll be prompted for your password and once entered, your credentials
will be setup in your <code>~/.gem</code> folder. Now that we&rsquo;re all super
authenticated and what not we can push our new gem out to the world
using this simple command (notice that the file name is the same as the
one produced by the build command above):</p>

<pre><code class="bash">gem push sidekiq-workflow-0.0.1.gem 
</code></pre>

<p>You should see <code>Successfully registered gem: sidekiq-workflow (0.0.1)</code>
if everything was successful. You can now visit your dashboard on
RubyGems to see your gem. Head on over to the <a href="https://rubygems.org/gems/sidekiq-workflow">sidekiq-workflow gem site</a> to see the actual
sidekiq-workflow.</p>

<p><a name="conclusion"></a></p>

<h3>Conclusion</h3>

<p>So what have we accomplished here? We now have a basic gem skeleton, in
source control, and with a deployment procedure in place. Basically, we
have everything we need to start actually developing this gem. Next time
we&rsquo;ll talk about what it is that we&rsquo;re actually building and start
putting together the first bits of functionality.</p>

<p>Also, if you notice any errors/omissions or have any questions feel free
to comment below and I&rsquo;ll reply back as soon as I possibly can.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Build Your Own Rails Gem: Start to Finish]]></title>
    <link href="http://blog.badmonkeys.io/blog/2015/06/04/how-to-build-your-own-rails-gem/"/>
    <updated>2015-06-04T00:00:00-04:00</updated>
    <id>http://blog.badmonkeys.io/blog/2015/06/04/how-to-build-your-own-rails-gem</id>
    <content type="html"><![CDATA[<p>Introduces why we&rsquo;d want to create a Rails Gem and begins a step-by-step
guide to developing an actual open source Gem.</p>

<!-- more -->


<h2>Why build a gem?</h2>

<p>So a couple of months ago I wrote a batch workflow manager for BLiNQ&rsquo;s
SMB Solo product.  The point here was that we had a large volume of
background operations to perform when we launched an account.  We did
all these batch operations using <a href="http://sidekiq.org/">Sidekiq</a> and
<a href="http://redis.io/">Redis</a>.  Some could be paralleled, and some depended
on previous batches to complete.  We couldn&rsquo;t break these down into
large sequential jobs within a single batch because we work with the
Facebook API&hellip;not the most reliable partner ever, so we needed to be
smart about retries.</p>

<p>It also allowed us to execute workflows like this using a definition of
sorts and made it possible to define the workflows at run-time.  I
thought this was just an edge case in my niche, but I talked a bit about
the code to other teams and they seemed really interested.  I set out to
make a gem so they could use it over on their products.  The
functionality is easily generalized and the added level of abstraction
needed to model workflows like these is valuable.</p>

<p><img src="https://lh4.googleusercontent.com/A9DsdHvVON8hgSB4XkEWDvcV_8UPz79Hd7qUp2_HxzC2M2WxtjCF-YWpbpqIKqHaXDYhFWyBmbkzyddg-QyHL1RBGUFoXJ72uiVehNzpsRQzz66NKyvBviLa" alt="complex-workflows" /></p>

<p>So I started by following the guides over at
<a href="http://guides.rubygems.org/make-your-own-gem/">RubyGems</a> and pushed an
empty module up to my <a href="https://rubygems.org/profiles/thebadmonkeydev">RubyGems
Profile</a>.  If you go to
my profile you can see that I&rsquo;ve screwed around with the verioning
pattern and some basic tests and shell methods over the last month, but
not much else.  There&rsquo;s still no real functionality.However, since May
18th, it&rsquo;s been downloaded more than 250 times!!</p>

<h2>Why build a gem out in public like this?</h2>

<p>Since I was already planning a tutorial post about creating a new rails
gem, I decided that since there is obviously demand for this kind of
functionality, why not build it publicly and let people learn from a gem
that is actually useful versus the whole &ldquo;Hello World&rdquo; approach of
online guides.</p>

<p>Most of us learn by doing and it can be difficult to get off the ground
with a new topic if you don&rsquo;t have the opportunity to work on something
that&rsquo;s not trivial.  In response to these far-too-simple guides around
the interwebz, I&rsquo;m going to build this gem step by step here on my blog
so that you can build actual experience with gem development.  I only
ask that if you do follow along and push your gem out, please change the
name so there&rsquo;s no confusion with mine as I plan to continue maintaining
it after this tutorial is over.</p>

<h2>So&hellip;</h2>

<p>Over the next several weeks I&rsquo;m going to discuss in depth my experience
developing this gem, which I will be calling &lsquo;sidekiq-workflow&rsquo;.  We&rsquo;ll
walk through the process of creating the initial gem itself to the final
touches implementing actual workflow functionality together.  I will be
loosely following a <a href="http://en.wikipedia.org/wiki/Test-driven_development">Test-Driven Development
(TDD)</a> approach.
 However, I will be developing this in a rapid time frame and will
certainly stray from TDD in the strictest sense&hellip;you should get a feel
for how I develop day-to-day.  I try to strike a balance between
following a strict uniform process and the real-world down and dirty
approach that we all use but don&rsquo;t talk about.</p>

<p>I&rsquo;m also going to be using some very popular tools for open source
projects along the way and will walk through setting them up for
sidekiq-workflow:
<a href="https://github.com">Github</a>
<a href="https://travis-ci.org">TravisCI</a>
<a href="https://codeclimate.com">CodeClimate</a></p>

<table>
<tbody>
<tr>
<th>Let's Get Started</th>
</tr>
<tr>
<td><a
href="https://badmonkeydev.wordpress.com/2015/06/09/how-to-build-your-own-rails-gem-part-1/">Creating
a Basic Gem and Setting Up Github</a>
</td>
</tr>
<tr>
<td>What we're building and first tests <small
style="float:right;">Coming Soon</small></td>
</tr>
<tr>
<td>Core Features and Using CodeClimate <small
style="float:right;">Coming Soon</small></td>
</tr>
<tr>
<td>Finishing Touches and Publishing a Github Release <small
style="float:right;">Coming Soon</small></td>
</tr>
</tbody>
</table>



]]></content>
  </entry>
  
</feed>
